# AutoLayout

View のレイアウトを決定する仕組みのひとつに Auto Layout があります。  
制約(`NSLayoutConstraint`)を組み合わせて View のレイアウトを解決します。  
制約とは例えば`このViewの上辺は親のViewの上辺からXポイントあける`、`このViewとこのViewの幅は同じにする`
のようなものです。

Apple の Document  
[NSLayoutConstraint](https://developer.apple.com/documentation/uikit/nslayoutconstraint)  
[Auto Layout Guide](https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/)

InterfaceBuilder で制約を与える方法、NSLayoutConstraint オブジェクトを使用してコードで制約を与える方法のほか、サードパーティのライブラリでコードから直感的に制約を与えられるものもあります。  
[SnapKit](https://github.com/SnapKit/SnapKit)

## 他の方法

iOS には他にもさまざまなレイアウトの指定方法がありますが、おおまかには AutoLayout とフレーム指定の 2 種類があります。

| 手法         | メリット                                                       | デメリット                                                       |
| ------------ | -------------------------------------------------------------- | ---------------------------------------------------------------- |
| AutoLayout   | 画面幅に応じた処理を書かなくて済む。回転も特に気にしなくて良い | 処理が遅い                                                       |
| フレーム指定 | AutoLayout と違いフレームの計算が入らない分処理が早い          | 画面幅、回転などを考慮して計算しなくてはいけないためとにかく大変 |

## 組み方の考え方

iOS の座標系は画面左上を原点とし原点の座標と横幅縦幅の CGRect で管理されています。

また親 View が存在する場合はその親 View の左上が子 View にとっての原点になります。
(これは、親 View からはみ出すようなレイアウトを組む際に重要になってきます)

AutoLayout でレイアウトを組む際は必ず 4 つの制約が必要になります。(例外あり)

制約が 5 個だったり、3 個だったりするものは何かおかしいので修正をしましょう。

よく使う組み方としては、

1. 左辺 x 軸
2. 上辺 y 軸
3. 右辺 x 軸
4. 縦幅

の指定や

1. 中心点 x 軸
1. 中心点 y 軸
1. 横幅
1. 縦幅

の指定です。上記は一例ですが、指定の仕方によって組みやすいレイアウトがあったりします。

例えば下図ではセンタライズする場合は中心点の指定が欲しくなります。（しなくてもできるが、座標の計算が必要になり画面サイズが変わった時の対応が大変）

| 例 1                           | 例 2                           |
| ------------------------------ | ------------------------------ |
| ![1](./images/autolayout1.png) | ![2](./images/autolayout2.png) |

### 例外

例外として、UIStackView や UILabel や UIImageView などは中のコンテンツに応じてサイズを変えることができるコンポーネントです。これらは横幅や縦幅の制約を指定せずとも高さや横幅を自動で計算してくれます。

組みたいレイアウトによってどの制約を外すかが決まりますが、比較的よく使うのは UILabel で横幅固定の縦幅可変です

以下の画像では、文字列の長さに応じて UILabel の高さが変わっていることがわかります

| 複数行                         | 単行                           |
| ------------------------------ | ------------------------------ |
| ![3](./images/autolayout3.png) | ![4](./images/autolayout4.png) |

# サンプル

## コンポーネント がグリッド上に並ぶレイアウト

条件としては

- 横幅はマージンを除いた横幅の 1/3
- 高さもマージンを除いた高さの 1/3
- 回転してもこの比率は変わらない

とします。

このようなレイアウトの場合は以下のように実装します

![実装例](images/autolayout-sample-1.png)
|縦|横|
|---|---|
|![横](images/autolayout-sample-2.png)|![縦](images/autolayout-sample-3.png)|

各 UIView は UIStackView の子 View として、さらにそれらの UIStackView を一つの UIStackView に入れることで実現しました。

各 UIView はそれぞれに等幅の制約をつけることで等間隔に配置をします。

UIStackView に存在する Spacing にマージン幅(高さ)を入れることで自動的に UIView 間にはそのマージンが入るようになります。

縦に並んでいる UIStackView に関して同じ高さの制約をつけることでグリッド状のレイアウトが出来上がります。

現在は等幅等高にしていますがこの比率を変えることで、さまざまなレイアウトを組むことができます。

~~なおグリッド状のレイアウトを組むのであれば UICollectionView にするのが手っ取り早いというツッコミは無しでお願いします~~

## Min 指定

上記の UILabel の例では画面に収まる量の文字列でした。しかし、この文字列がもっと長かったらどうでしょうか？

![sample2-1](./images/autolayout-sample2-1.png)

オレンジ色の線が見えなくなってしまいました。

ここでデザイナーから注文が入ります。

- 画面からはみ出すぐらいの文字列だったら文字列を省略する
- だけど、文字列が少ないならその分上に詰める

といったレイアウトを組んでみましょう

画面からはみ出してはいけないので、オレンジ色の view を画面下端に配置すると制約をつけます

|                                                 |                                                 |
| ----------------------------------------------- | ----------------------------------------------- |
| ![sample2-3](./images/autolayout-sample2-3.png) | ![sample2-2](./images/autolayout-sample2-2.png) |

ラベルが省略されてますが、文字列が短い場合でも下まで伸びてますし、文字列が真ん中に来てしまいました。

修正しましょう。

AutoLayout の制約は Equal だけでなく less than or equal (より小さい), greater than or equal (より大きい) が使えます

この制約を使いましょう

オレンジ色の view を画面の下端以上にします。もう少し詳しく書くとオレンジ色の view を画面下端の 0pt より上に配置するようにします

| 文字列が短い場合                                | 文字列が長い場合                                |
| ----------------------------------------------- | ----------------------------------------------- |
| ![sample2-4](./images/autolayout-sample2-4.png) | ![sample2-5](./images/autolayout-sample2-5.png) |

要望通りのレイアウトになりました。
